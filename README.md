# PDF編集Webアプリ

書類等をスキャンした際に、見開きページの分割、不要ページの削除、ページの回転、順序の整理などを視覚的に行い、見やすいPDFに仕上げるためのWebアプリケーションです。

## 🚀 クイックスタート（初めての方）

1. **このフォルダ内の `start_server.bat` をダブルクリック**してください
2. 黒い画面（コマンドプロンプト）が開いてサーバーが起動します
3. ブラウザで http://127.0.0.1:5000 を開いてください
4. 使い終わったら、黒い画面で `Ctrl+C` を押してサーバーを終了します

**注意**: 初回起動時にエラーが出る場合は、下記の「セットアップ」を先に行ってください。

## 使用目的

スキャナーで書類をスキャンする際によくある問題を解決します：
- 📖 **見開きページの分割**: 本や資料を見開きでスキャンした場合、左右を別々のページに分割
- 🗑️ **不要ページの削除**: 空白ページや不要な表紙などを簡単に削除
- 🔄 **ページの回転**: 向きが間違っているページを正しい向きに修正
- 📑 **ページの並べ替え**: スキャン順が前後してしまったページを正しい順序に整理
- 💾 **1クリックで保存**: 編集結果をワンクリックでPDFとしてダウンロード

すべての操作がブラウザ上で完結し、サムネイルを見ながら直感的に編集できます。

## 主な機能

### PDFの追加とクリア
- PDFファイルを最大5つまでまとめて選択してアップロード
- 選択したファイル名が完全に表示され、ホバーで全体を確認可能
- 選択した順にページが追加されます
- 全ページをクリアして最初からやり直し

### ページ分割
- 横長ページ（見開きでスキャンしたページ）を自動検出して左右に分割
- 選択したページのみ分割、または全ての横長ページを一括分割

### ページ削除
- サムネイルをクリックして削除対象を選択（赤い枠と「×」マークで表示）
- 複数ページを同時に選択して一括削除
- 削除後、即座にサムネイルが更新

### ページ編集
- サムネイルをクリックして選択（黄色い枠で表示）
- 左90°回転 / 右90°回転ボタンでページの向きを修正
- 偶数・奇数ページ入れ替え、全ページ逆順などの一括操作

### ページ並べ替え
- **方法1**: クリックした順にページを並べ替え（丸数字①②③...で表示されます）
- **方法2**: 1ページを選択して「前へ」「次へ」ボタンで位置を微調整
- 偶数・奇数ページ入れ替え、全ページ逆順などの操作も可能

### PDFを保存
- 現在の編集状態をプレビュー
- 「名前をつけてダウンロード」ボタンで保存
  - 最初にアップロードしたファイル名が自動入力される
  - ファイル名を自由に変更してダウンロード可能

### 共通機能
- すべてのタブで編集内容が共有され、シームレスに作業可能
- サムネイルサイズをスライダーで調整可能
- タブ切り替えはキャッシュされ、高速に動作
- **スティッキーヘッダー**: 編集タブでスクロールしても操作ボタンが画面上部に固定
  - 画面が小さい時は説明文を自動的に非表示にして操作領域を確保
- ブラウザ更新時は自動的にクリーンな状態に戻ります

## セットアップ

### 必要な環境
- Python 3.7以上

### Windows の場合

1.  **Pythonのインストール確認**:
    ```bash
    python --version
    # または
    py --version
    ```

    インストールされていない場合は [Python公式サイト](https://www.python.org/downloads/)からダウンロードしてください。
    **重要**: インストール時に「Add Python to PATH」にチェックを入れてください。

2.  **プロジェクトのディレクトリに移動**:
    コマンドプロンプトを開き、このアプリのフォルダに移動します。

    例えば、`C:\Users\YourName\Downloads\PDF_ページ編集` にアプリがある場合:
    ```bash
    cd C:\Users\YourName\Downloads\PDF_ページ編集
    ```

    **簡単な方法**: エクスプローラーでこのフォルダを開き、アドレスバーに `cmd` と入力してEnterを押すと、そのフォルダでコマンドプロンプトが開きます。

3.  **必要なライブラリのインストール**:
    ```bash
    pip install Flask PyMuPDF pypdf
    # または
    py -m pip install Flask PyMuPDF pypdf
    ```

### Mac の場合

1.  **Pythonのインストール確認**:
    ```bash
    python3 --version
    ```

    インストールされていない場合:
    ```bash
    brew install python3
    ```

2.  **プロジェクトのディレクトリに移動**:
    ターミナルを開き、このアプリのフォルダに移動します。

    例えば、`/Users/YourName/Downloads/PDF_ページ編集` にアプリがある場合:
    ```bash
    cd /Users/YourName/Downloads/PDF_ページ編集
    ```

    **簡単な方法**: Finderでこのフォルダを開き、フォルダを右クリック→「サービス」→「フォルダに新規ターミナル」を選択すると、そのフォルダでターミナルが開きます。

3.  **必要なライブラリのインストール**:
    ```bash
    pip3 install Flask PyMuPDF pypdf
    ```

## 実行方法

### Windows
```bash
python app.py
# または
py app.py
```

### Mac
```bash
python3 app.py
```

サーバーが起動したら、ブラウザで `http://127.0.0.1:5000` にアクセスしてください。

## 使い方の流れ

### 基本的な使い方

1. **PDFの追加とクリア**タブでPDFファイルをアップロード
2. 各タブ（分割、削除、編集、並べ替え）で必要な編集を実行
   - タブは任意の順序で使用可能
   - 編集内容はすべてのタブで共有されます
3. **PDFを保存**タブで最終確認し、「名前をつけてダウンロード」をクリック
   - 最初にアップロードしたファイル名が入力欄に表示されます
   - 必要に応じてファイル名を変更できます

### 典型的な使用例：見開きスキャンした本を整理

1. **PDFの追加**: スキャンしたPDFをアップロード
2. **ページ分割**: 「すべての横長ページを分割」で見開きを左右に分割
3. **ページ削除**: 空白ページや表紙など不要なページを削除
4. **ページ編集**: 向きが逆のページを回転
5. **ページ並べ替え**: 必要に応じてページ順を調整
6. **PDFを保存**: 編集結果をダウンロード

## サーバーの終了方法

サーバーを起動したターミナル/コマンドプロンプトで `Ctrl+C` を押すとサーバーが停止します。

## 技術仕様

- **バックエンド**: Flask (Python)
- **PDF処理**: PyMuPDF (サムネイル生成・ページ分割), pypdf (ページ操作)
- **フロントエンド**: Vanilla JavaScript, CSS

## 注意事項

- このアプリは開発用サーバーで動作します。個人のPC上でローカルに使用することを想定しています。
- ブラウザを更新すると、サーバー側のデータは自動的にクリアされます。
- 編集中のPDFは一時的にサーバー上の `uploads/` フォルダに保存されます。
- タブを切り替えてもサムネイルはキャッシュされ、再読み込みは発生しません（高速動作）。
- PDF編集操作（削除、回転、分割など）を行うと、すべてのタブのサムネイルが自動更新されます。

## トラブルシューティング

### 変更が反映されない場合
ブラウザのキャッシュをクリアして再読み込み:
- Windows: `Ctrl+F5`
- Mac: `Cmd+Shift+R`

### ページが削除/編集できない場合
- ブラウザを完全に更新してPDFを再アップロード
- ブラウザの開発者ツール（F12）のコンソールでエラーを確認

## 更新履歴

### 2025-10-20
- **ワンクリック起動機能**: より簡単にアプリを起動できるように改善
  - `start_server.bat` ファイルを追加（ダブルクリックでサーバー起動）
  - Python自動検出機能（`python` または `py` コマンドを自動判別）
  - README.html内にクイックスタートセクションを追加
  - アプリURL（http://127.0.0.1:5000）をクリック可能なリンクに変更
- **名前をつけてダウンロード機能**: PDFを保存する際にファイル名を指定可能に
  - 最初にアップロードしたファイル名を自動的に記憶
  - モーダルダイアログでファイル名を編集可能
  - Enterキーでクイックダウンロードに対応
- **スティッキーヘッダー**: 各編集タブでスクロール時に操作ボタンが画面上部に固定
  - ページ分割、ページ削除、ページ編集、ページ並べ替えの各タブで有効
  - 画面高さが700px以下の場合は説明文を自動非表示にしてサムネイル表示領域を確保
  - 長いページをスクロールしても常にボタンとサムネイルサイズバーにアクセス可能

### 2025-10-17
- **複数ファイル一括選択機能**: 最大5つのPDFファイルをまとめて選択してアップロード可能に
  - 各ファイル入力フィールドに完全なファイル名を表示
  - 長いファイル名は省略表示され、ホバーで全体を確認可能
  - 選択した順にページが追加される
- **丸数字表示機能**: ページ並べ替えタブでクリックした順を丸数字（①②③...）で表示
  - より視覚的に分かりやすい順序表示
  - 最大50ページまで丸数字に対応

### 2025-10-16
- **タブ機能の追加**: 6つのタブによる統合UI
  - PDFの追加とクリア、ページ分割、ページ削除、ページ編集、ページ並べ替え、PDFを保存
- **ページ削除機能**: サムネイルをクリックして複数ページを選択削除
- **ページ回転機能**: 左90°/右90°回転、偶数・奇数ページ入れ替え、全ページ逆順
- **ページ並べ替え機能**: クリック順での並べ替え、前へ/次へボタンでの微調整
- **サムネイルサイズ調整**: スライダーでサムネイルサイズを変更可能
- **状態管理の改善**: タブ間でのデータ共有とギャラリーキャッシング

### 2025-10-15
- **初期リリース**: PDF見開きページ分割機能
  - 横長ページの自動検出と左右分割
  - サムネイルプレビュー表示
  - Flask + PyMuPDF + pypdfによる実装
