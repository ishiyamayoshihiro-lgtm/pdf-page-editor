# PDF編集Webアプリ

書類等をスキャンした際に、見開きページの分割、不要ページの削除、ページの回転、順序の整理などを視覚的に行い、見やすいPDFに仕上げるためのWebアプリケーションです。

## 🚀 クイックスタート（初めての方）

1. **このフォルダ内の `start_server.bat` をダブルクリック**してください
2. 黒い画面（コマンドプロンプト）が開いてサーバーが起動します
3. ブラウザで [http://127.0.0.1:5000](http://127.0.0.1:5000) を開いてください
4. 使い終わったら、黒い画面で `Ctrl+C` を押してサーバーを終了します

**注意**: 初回起動時にエラーが出る場合は、下記の「セットアップ」を先に行ってください。

## 使用目的

スキャナーで書類をスキャンする際によくある問題を解決します：
- 📖 **見開きページの分割**: 本や資料を見開きでスキャンした場合、左右を別々のページに分割
- 🗑️ **不要ページの削除**: 空白ページや不要な表紙などを簡単に削除
- 🔄 **ページの回転**: 向きが間違っているページを正しい向きに修正
- 📑 **ページの並べ替え**: スキャン順が前後してしまったページを正しい順序に整理
- 🖍️ **マスキング（黒塗り）**: 個人情報や機密情報を黒塗りで隠す
- ✂️ **ファイル分割**: PDFを複数のファイルに分割して個別に保存
- 📄 **個別ファイル保存**: 各ページを個別のPDFファイルとしてZIP保存
- 🖼️ **画像PDF変換**: フォント問題を回避するため画像ベースのPDFに変換
- 💾 **1クリックで保存**: 編集結果をワンクリックでPDFとしてダウンロード

すべての操作がブラウザ上で完結し、サムネイルを見ながら直感的に編集できます。

## 主な機能

### PDFの追加とクリア
- **ドラッグ＆ドロップ対応**: ファイル選択ボタンの右側にある専用エリアにファイルをドラッグ＆ドロップして簡単アップロード
- PDFファイルを最大5つまでまとめて選択してアップロード
- 選択したファイル名が完全に表示され、ホバーで全体を確認可能
- 選択した順にページが追加されます
- 全ページをクリアして最初からやり直し

### 見開き分割
- 横長ページ（見開きでスキャンしたページ）を自動検出して左右に分割
- 選択したページのみ分割、または全ての横長ページを一括分割

### ページ削除
- サムネイルをクリックして削除対象を選択（赤い枠と「×」マークで表示）
- 複数ページを同時に選択して一括削除
- 削除後、即座にサムネイルが更新

### ページ編集
- サムネイルをクリックして選択（黄色い枠で表示）
- 左90°回転 / 右90°回転ボタンでページの向きを修正
- 偶数・奇数ページ入れ替え、全ページ逆順などの一括操作

### ページ並べ替え
- **方法1**: クリックした順にページを並べ替え（丸数字①②③...で表示されます）
- **方法2**: 1ページを選択して「前へ」「次へ」ボタンで位置を微調整
- 偶数・奇数ページ入れ替え、全ページ逆順などの操作も可能

### マスキング（黒塗り）
- PDFの特定領域を黒塗りで隠すことができます
- ページを選択すると大きなキャンバスに表示され、マウスドラッグで範囲指定
- ページ間隔とオフセットを指定して、複数ページに同じ位置のマスキングを一括適用
- 個人情報や機密情報を隠すのに便利

### ファイル分割
- サムネイル間の縦線をクリックして分割位置を指定
- 複数の分割線を設定してPDFを複数のファイルに分割
- 各パートのファイル名を個別に指定可能
- 「保存不要」チェックボックスで不要なパートをスキップ
- 日本語ファイル名に完全対応（個別ダウンロード方式）
- **使用例**: 10ページのPDFで3ページ目と7ページ目に分割線を入れると「1～3ページ」「4～7ページ」「8～10ページ」の3つに分割。不要なパートにチェックを入れると保存されません

### 個別ファイル保存
- PDFの各ページを個別のPDFファイルとして保存
- 例：「資料.pdf」（5ページ）→「資料_1.pdf」「資料_2.pdf」...をZIPでまとめてダウンロード
- **画像PDF変換オプション**: フォント問題を回避するため、各ページを画像PDFとして保存可能
- 画質（DPI）を選択可能: 96/150/200/300 DPI

### PDFを保存
- 現在の編集状態をプレビュー
- 「名前をつけてダウンロード」ボタンで保存
  - 最初にアップロードしたファイル名が自動入力される
  - ファイル名を自由に変更してダウンロード可能
- **画像PDF変換機能**: フォントが正しく表示されない問題を解決
  - PDFを画像ベースのPDFに変換して保存（画質選択可能）

### 共通機能
- すべてのタブで編集内容が共有され、シームレスに作業可能
- サムネイルサイズをスライダーで調整可能
- タブ切り替えはキャッシュされ、高速に動作
- **Undo/Redo機能**: 元に戻す（Ctrl+Z）・やり直す（Ctrl+Y）ボタンで操作を取り消し/やり直し
  - 最大20個の履歴を保存し、いつでも前の状態に戻せます
- **スティッキーヘッダー**: 編集タブでスクロールしても操作ボタンが画面上部に固定
  - 画面が小さい時は説明文を自動的に非表示にして操作領域を確保
- ブラウザ更新時は自動的にクリーンな状態に戻ります

## セットアップ（初回のみ）

`start_server.bat` を実行してエラーが出る場合は、以下の3ステップでセットアップしてください：

### 📝 3ステップでセットアップ

1. **Pythonをインストール**（入っていない場合のみ）
   [Python公式サイト](https://www.python.org/downloads/)からダウンロードしてインストール
   **重要**: インストール時に「Add Python to PATH」にチェックを入れてください

2. **このフォルダでコマンドプロンプトを開く**
   エクスプローラーでこのフォルダを開き、アドレスバーに `cmd` と入力してEnter

3. **必要なライブラリをインストール**
   以下のコマンドをコピーして貼り付けてEnter:
   ```bash
   pip install Flask PyMuPDF pypdf
   ```
   うまくいかない場合は以下も試してください:
   ```bash
   py -m pip install Flask PyMuPDF pypdf
   ```

### 💡 それでもうまくいかない場合

下記のリンクから Gemini に質問してみてください。「Python」「Flask」「PyMuPDF」「pypdf」のインストール方法を教えてくれます：

**[Gemini で質問する](https://gemini.google.com/app?hl=ja)**

Gemini への質問例:
「**WindowsでPythonとFlask、PyMuPDF、pypdfをインストールする手順を教えて**」

### Mac をお使いの場合

1. ターミナルを開く（Finder → アプリケーション → ユーティリティ → ターミナル）
2. このアプリのフォルダに移動（例: `cd ~/Downloads/PDF_ページ編集`）
3. 以下を実行:
   ```bash
   pip3 install Flask PyMuPDF pypdf
   ```

## 起動方法

### 簡単な方法（Windows）
`start_server.bat` をダブルクリック → ブラウザで [http://127.0.0.1:5000](http://127.0.0.1:5000) を開く

### コマンドで起動する方法

**Windows:**
```bash
python app.py
# または
py app.py
```

**Mac:**
```bash
python3 app.py
```

サーバーが起動したら、ブラウザで [http://127.0.0.1:5000](http://127.0.0.1:5000) にアクセスしてください。

## 使い方

### 📱 基本的な流れ

1. **取り込み** → 「PDFの追加とクリア」タブでPDFをアップロード（ドラッグ&ドロップまたはファイル選択）
2. **編集** → 各タブで必要な編集作業を行う（順序は自由）
   - 📖 見開き分割：横長ページを左右に分割
   - 🗑️ ページ削除：不要なページを削除
   - 🔄 ページ編集：回転、ページ入れ替え、逆順など
   - 📑 ページ並べ替え：クリック順または前後移動で並べ替え
   - 🖍️ マスキング：黒塗りで情報を隠す
3. **保存** → 編集結果を保存
   - ✂️ ファイル分割保存：PDFを複数ファイルに分割してダウンロード
   - 📄 個別ページ保存：各ページを個別のPDFファイルとしてZIP保存
   - 💾 全体を保存：編集したPDFをまるごとダウンロード

### 💡 よくある使い方

#### パターン1：見開きスキャンした本を整理
1. 「PDFの追加」でスキャンしたPDFをアップロード
2. 「見開き分割」で横長ページを左右に分割
3. 「ページ削除」で空白ページを削除
4. 「ページ編集」で向きが逆のページを回転
5. 「全体を保存」で完成したPDFをダウンロード

#### パターン2：複数の書類をまとめて分類
1. 「PDFの追加」で複数のPDFをまとめてアップロード
2. 「ページ並べ替え」で順序を整理
3. 「ファイル分割保存」でページ範囲ごとに別ファイルとして保存

#### パターン3：個人情報を隠して共有
1. 「PDFの追加」で書類をアップロード
2. 「マスキング」で個人情報部分を黒塗り
3. 「全体を保存」で黒塗りPDFをダウンロード

#### パターン4：フォント問題を解決
1. 「PDFの追加」でPDFをアップロード
2. 「全体を保存」または「個別ページ保存」で「画像PDFとして保存」にチェック
3. 画質（DPI）を選択してダウンロード

※ PDFを画像化することで、どの環境でも同じように表示されるようになります

### ⌨️ 便利なショートカット
- **Ctrl+Z**: 元に戻す（最大20回）
- **Ctrl+Y**: やり直す
- **Ctrl+F5** (Windows) / **Cmd+Shift+R** (Mac): ブラウザの完全リロード

## サーバーの終了方法

サーバーを起動したターミナル/コマンドプロンプトで `Ctrl+C` を押すとサーバーが停止します。

## インターネット経由で使用する（オンラインデプロイ）

**外出先や他のPCからもアクセスしたい場合**は、PythonAnywhereにデプロイできます。

### 特徴
- 完全無料（クレジットカード不要）
- メールアドレスだけで登録可能
- `あなたのユーザー名.pythonanywhere.com` でアクセス可能
- HTTPS対応で安全

### デプロイ方法
詳しい手順は [DEPLOYMENT.md](DEPLOYMENT.md) を参照してください。

**概要**：
1. [PythonAnywhere](https://www.pythonanywhere.com/) でアカウント作成
2. ファイルをアップロード（GitHubまたは手動）
3. 必要なパッケージをインストール
4. Webアプリを設定
5. 完了！どこからでもアクセス可能に

## 技術仕様

- **バックエンド**: Flask (Python)
- **PDF処理**: PyMuPDF (サムネイル生成・ページ分割), pypdf (ページ操作)
- **フロントエンド**: Vanilla JavaScript, CSS

## ライセンス

(c) 2025 IshiyamaYoshihiro

このプロジェクトは MIT License のもとで公開されています。

## 注意事項

- このアプリは開発用サーバーで動作します。個人のPC上でローカルに使用することを想定しています。
- ブラウザを更新すると、サーバー側のデータは自動的にクリアされます。
- 編集中のPDFは一時的にサーバー上の `uploads/` フォルダに保存されます。
- タブを切り替えてもサムネイルはキャッシュされ、再読み込みは発生しません（高速動作）。
- PDF編集操作（削除、回転、分割など）を行うと、すべてのタブのサムネイルが自動更新されます。

## トラブルシューティング

### 変更が反映されない場合
ブラウザのキャッシュをクリアして再読み込み:
- Windows: `Ctrl+F5`
- Mac: `Cmd+Shift+R`

### ページが削除/編集できない場合
- ブラウザを完全に更新してPDFを再アップロード
- ブラウザの開発者ツール（F12）のコンソールでエラーを確認

## 更新履歴

### 2026-01-01
- **オンラインデプロイ対応**: PythonAnywhereへのデプロイに対応し、インターネット経由でどこからでもアクセス可能に
  - オンライン版URL: https://ishpdfeditor.pythonanywhere.com
  - オンライン版とローカル版の両方で使用可能（状況に応じて使い分け可能）
  - 完全無料でクレジットカード不要のPythonAnywhereを使用
  - HTTPS対応で安全にアクセス可能
- **デプロイ関連ファイルの追加**:
  - `requirements.txt`: パッケージ依存関係の定義
  - `DEPLOYMENT.md`: 詳細なデプロイ手順書
  - `pythonanywhere_wsgi.py`: PythonAnywhere用WSGI設定テンプレート
  - `QUICKSTART.md`: オンライン版とローカル版の比較ガイド
- **README.html更新**: クイックスタートセクションをオンライン版優先に変更
  - オンライン版を緑色のボックスで目立つように表示
  - ローカル版は「オンライン版が使えない場合」の選択肢として配置
- **本番環境対応**: ファイルサイズ制限（50MB）と環境変数による動作切り替えを実装

### 2025-12-08
- **ファイル分割UI改善**: サムネイル間の縦線（分割線）のクリック判定を改善
  - 縦線の左右に30px（片側15px）のクリック可能領域を追加
  - 視覚的な見た目は変わらず、クリック判定だけを拡大
  - 縦線から少しズレた位置をクリックしても確実に反応するようになりました

### 2025-12-04
- **マスキング座標計算の修正**: マスキング機能で想定した場所と違う場所にマスキングされる問題を修正
  - フロントエンド: キャンバスの表示サイズと内部解像度の比率を正しく計算するように改善
  - バックエンド: ページコピーとマスキング描画の順序を修正し、マスキングが確実に反映されるように変更
  - これにより、マウスで選択した領域に正確にマスキングが適用されるようになりました

### 2025-12-01
- **ドラッグ＆ドロップ機能の追加**: ファイルをドラッグ＆ドロップで簡単に追加可能に
  - ファイル選択エリアの右側に専用の「ここにファイルをドラッグ＆ドロップ」エリアを設置
  - ドラッグ中はエリアがハイライトされ、直感的に操作可能


### 2025-11-27
- **ファイル分割機能の追加**: PDFを任意の位置で複数のファイルに分割
  - サムネイル間に縦線（分割線）を表示し、クリックで分割位置を指定
  - ハサミマーク（✂）で分割位置を視覚的に表示
  - モーダルダイアログで各パートのファイル名を個別に指定
  - 「保存不要」チェックボックスで不要なパートをスキップ可能
  - ページ範囲（例：1～3ページ）を自動表示
  - 日本語ファイル名に完全対応（個別ダウンロード方式で文字化けを防止）
  - 使用例: 10ページのPDFを「前半.pdf」（1～3ページ）と「後半.pdf」（8～10ページ）に分割し、中間部分（4～7ページ）はスキップ
- **UIの大幅改善 - 階層化タブの実装**: タブが増えて見にくくなった問題を解決
  - 2段階のタブ構造に変更（グループタブ + サブタブ）
  - グループタブ: 「取り込み」「編集」「保存」の3つに分類
  - グループをクリックすると下段に関連するサブタブが表示される
  - タブ名をより分かりやすく変更:
    - 「ファイル分割」→「ファイル分割保存」
    - 「個別ファイル保存」→「個別ページ保存」
    - 「PDFを保存」→「全体を保存」
  - 画面幅が狭くてもタブが改行されず、すっきり表示

### 2025-11-14
- **個別ファイル保存機能**: PDFの各ページを個別のPDFファイルとして保存
  - 各ページが「ファイル名_1.pdf」「ファイル名_2.pdf」...として保存され、ZIPファイルでまとめてダウンロード
  - 画像PDF変換オプションを搭載（フォント問題の回避）
  - 画質選択機能: 96/150/200/300 DPIから選択可能
- **画像PDF変換機能**: フォントが正しく表示されない問題を解決
  - PDFを画像ベースのPDFに変換して保存
  - 「PDFを保存」タブに画像PDF変換オプションを追加
  - すべてのページが画像として保存されるため、どの環境でも正しく表示される
- **タブ名の変更**: より分かりやすい名称に変更
  - 「ページ分割」→「見開き分割」
  - 「ページ分割保存」→「個別ファイル保存」（新規追加機能）

### 2025-10-24
- **GitHub管理を開始**: 他アプリでGitHubを使う為にアカウントを作成したので、このアプリもバージョン管理を開始
  - リポジトリURL: https://github.com/ishiyamayoshihiro-lgtm/pdf-page-editor
  - コードの変更履歴が記録され、いつでも過去のバージョンに戻せるようになりました
  - `.gitignore` ファイルを追加してログファイルや一時ファイルを除外
  - `CLAUDE.md` を追加: Claude Codeでの開発ガイドライン

### 2025-10-20
- **ワンクリック起動機能**: より簡単にアプリを起動できるように改善
  - `start_server.bat` ファイルを追加（ダブルクリックでサーバー起動）
  - Python自動検出機能（`python` または `py` コマンドを自動判別）
  - README.html内にクイックスタートセクションを追加
  - アプリURL（http://127.0.0.1:5000）をクリック可能なリンクに変更
- **名前をつけてダウンロード機能**: PDFを保存する際にファイル名を指定可能に
  - 最初にアップロードしたファイル名を自動的に記憶
  - モーダルダイアログでファイル名を編集可能
  - Enterキーでクイックダウンロードに対応
- **スティッキーヘッダー**: 各編集タブでスクロール時に操作ボタンが画面上部に固定
  - ページ分割、ページ削除、ページ編集、ページ並べ替えの各タブで有効
  - 画面高さが700px以下の場合は説明文を自動非表示にしてサムネイル表示領域を確保
  - 長いページをスクロールしても常にボタンとサムネイルサイズバーにアクセス可能

### 2025-10-17
- **複数ファイル一括選択機能**: 最大5つのPDFファイルをまとめて選択してアップロード可能に
  - 各ファイル入力フィールドに完全なファイル名を表示
  - 長いファイル名は省略表示され、ホバーで全体を確認可能
  - 選択した順にページが追加される
- **丸数字表示機能**: ページ並べ替えタブでクリックした順を丸数字（①②③...）で表示
  - より視覚的に分かりやすい順序表示
  - 最大50ページまで丸数字に対応

### 2025-10-16
- **タブ機能の追加**: 6つのタブによる統合UI
  - PDFの追加とクリア、ページ分割、ページ削除、ページ編集、ページ並べ替え、PDFを保存
- **ページ削除機能**: サムネイルをクリックして複数ページを選択削除
- **ページ回転機能**: 左90°/右90°回転、偶数・奇数ページ入れ替え、全ページ逆順
- **ページ並べ替え機能**: クリック順での並べ替え、前へ/次へボタンでの微調整
- **サムネイルサイズ調整**: スライダーでサムネイルサイズを変更可能
- **状態管理の改善**: タブ間でのデータ共有とギャラリーキャッシング

### 2025-10-15
- **初期リリース**: PDF見開きページ分割機能
  - 横長ページの自動検出と左右分割
  - サムネイルプレビュー表示
  - Flask + PyMuPDF + pypdfによる実装
