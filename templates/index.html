<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF編集ツール</title>
    <link rel="stylesheet" href="/static/style.css">
    <!--
    PDF編集Webアプリケーション
    (c) 2025 IshiyamaYoshihiro
    License: MIT License
    -->
</head>
<body>
    <div class="container">
        <h1>PDF編集ツール</h1>

        <!-- タブナビゲーション -->
        <!-- グループタブ（上段） -->
        <div class="group-tab-navigation">
            <button class="group-tab-button active" data-group="import">取り込み</button>
            <button class="group-tab-button" data-group="edit">編集</button>
            <button class="group-tab-button" data-group="save">保存</button>
            <div style="margin-left: auto; display: flex; gap: 10px;">
                <button id="undo-button" class="history-button" disabled title="元に戻す (Ctrl+Z)">↶ 戻る</button>
                <button id="redo-button" class="history-button" disabled title="やり直す (Ctrl+Y)">↷ 進む</button>
            </div>
        </div>

        <!-- サブタブ（下段） -->
        <div class="sub-tab-navigation">
            <!-- 取り込みグループ -->
            <div class="sub-tab-group active" data-group="import">
                <button class="tab-button active" data-tab="upload">PDFの追加とクリア</button>
            </div>

            <!-- 編集グループ -->
            <div class="sub-tab-group" data-group="edit">
                <button class="tab-button" data-tab="split">見開き分割</button>
                <button class="tab-button" data-tab="delete">ページ削除</button>
                <button class="tab-button" data-tab="edit">ページ編集</button>
                <button class="tab-button" data-tab="reorder">ページ並べ替え</button>
                <button class="tab-button" data-tab="mask">マスキング</button>
            </div>

            <!-- 保存グループ -->
            <div class="sub-tab-group" data-group="save">
                <button class="tab-button" data-tab="file-split">ファイル分割保存</button>
                <button class="tab-button" data-tab="split-files">個別ページ保存</button>
                <button class="tab-button" data-tab="save">全体を保存</button>
            </div>
        </div>

        <!-- PDFアップロードタブ -->
        <div id="upload-tab" class="tab-content active">
            <div class="upload-section">
                <h2>PDFファイルを追加</h2>
                <p>編集したいPDFファイルを、左のボタンから選択するか、右のエリアにドラッグ＆ドロップしてください。</p>
                <div class="upload-area-container">
                    <div class="upload-controls">
                        <div class="file-inputs-container">
                            <div class="file-input-row">
                                <label class="file-input-label">1つ目のファイルを選択</label>
                                <input type="file" id="pdf-file-input-1" class="pdf-file-input" accept=".pdf">
                                <span id="filename-display-1" class="filename-display"></span>
                            </div>
                            <div class="file-input-row">
                                <label class="file-input-label">2つ目のファイルを選択</label>
                                <input type="file" id="pdf-file-input-2" class="pdf-file-input" accept=".pdf">
                                <span id="filename-display-2" class="filename-display"></span>
                            </div>
                            <div class="file-input-row">
                                <label class="file-input-label">3つ目のファイルを選択</label>
                                <input type="file" id="pdf-file-input-3" class="pdf-file-input" accept=".pdf">
                                <span id="filename-display-3" class="filename-display"></span>
                            </div>
                            <div class="file-input-row">
                                <label class="file-input-label">4つ目のファイルを選択</label>
                                <input type="file" id="pdf-file-input-4" class="pdf-file-input" accept=".pdf">
                                <span id="filename-display-4" class="filename-display"></span>
                            </div>
                            <div class="file-input-row">
                                <label class="file-input-label">5つ目のファイルを選択</label>
                                <input type="file" id="pdf-file-input-5" class="pdf-file-input" accept=".pdf">
                                <span id="filename-display-5" class="filename-display"></span>
                            </div>
                        </div>
                        <button id="upload-button">PDFを追加してプレビュー</button>
                    </div>
                    <div id="drop-zone" class="drop-zone-container">
                        <div class="drop-zone-icon">📤</div>
                        <div class="drop-zone-text">ここにファイルをドラッグ＆ドロップ<br>(最大5ファイル)</div>
                    </div>
                </div>
            </div>
            <div class="controls">
                <h2>全ページのクリア</h2>
                <p>現在読み込まれているすべてのページをクリアして、初めからやり直します。</p>
                <button id="clear-all-button">全ページをクリア</button>
            </div>
            <div class="status">
                <p id="status"></p>
            </div>
            <div id="gallery-upload" class="gallery"></div>
        </div>

        <!-- (他のタブは変更なし) -->
        <div id="split-tab" class="tab-content">
            <div class="placeholder">
                <p>←「PDFの追加とクリア」タブでファイルをアップロードすると、ここにプレビューが表示されます。</p>
            </div>
            <div class="controls sticky">
                <h2>見開き分割</h2>
                <p class="description">見開きでスキャンしたページを左右に分割します。横長ページが自動検出され、左右別々のページとして分割されます。</p>
                <button id="split-selected-button" disabled>選択した横長ページを分割</button>
                <button id="split-all-button" disabled>すべての横長ページを分割</button>
                <button id="clear-selection-button-split" disabled>選択をクリア</button>
                <div class="slider-container">
                    <label for="size-slider-split">サムネイルサイズ:</label>
                    <input type="range" id="size-slider-split" min="100" max="400" value="150">
                </div>
            </div>
            <div id="gallery-split" class="gallery"></div>
        </div>

        <div id="delete-tab" class="tab-content">
            <div class="placeholder">
                <p>←「PDFの追加とクリア」タブでファイルをアップロードすると、ここにプレビューが表示されます。</p>
            </div>
            <div class="controls sticky">
                <h2>削除するページをクリックして選択</h2>
                <p class="description">空白ページや不要なページをクリックして選択（赤い枠と「×」マークが表示されます）。複数ページを同時に選択できます。</p>
                <button id="delete-button" disabled>選択したページを削除</button>
                <button id="clear-selection-button-delete" disabled>選択をクリア</button>
                <div class="slider-container">
                    <label for="size-slider-delete">サムネイルサイズ:</label>
                    <input type="range" id="size-slider-delete" min="100" max="400" value="150">
                </div>
            </div>
            <div id="gallery-delete" class="gallery"></div>
        </div>

        <div id="edit-tab" class="tab-content">
            <div class="placeholder">
                <p>←「PDFの追加とクリア」タブでファイルをアップロードすると、ここにプレビューが表示されます。</p>
            </div>
            <div class="controls sticky">
                <h2>回転するページをクリックして選択</h2>
                <p class="description">向きが間違っているページをクリックして選択（黄色い枠が表示されます）。複数ページを同時に選択して回転できます。</p>
                <div class="button-group">
                    <button id="rotate-left-button" disabled>↺ 左90°回転</button>
                    <button id="rotate-right-button" disabled>↻ 右90°回転</button>
                    <button id="clear-selection-button-edit" disabled>選択をクリア</button>
                </div>
                <div class="slider-container">
                    <label for="size-slider-edit">サムネイルサイズ:</label>
                    <input type="range" id="size-slider-edit" min="100" max="400" value="150">
                </div>
            </div>
            <div id="gallery-edit" class="gallery"></div>
        </div>

        <div id="reorder-tab" class="tab-content">
            <div class="placeholder">
                <p>←「PDFの追加とクリア」タブでファイルをアップロードすると、ここにプレビューが表示されます。</p>
            </div>
            <div class="controls sticky">
                <h2>ページを並べ替え</h2>
                <p class="description"><strong>方法1：</strong>クリックした順に並べ替え（選択したページに番号が表示されます）<br>
                <strong>方法2：</strong>1ページ選択して「前へ」「次へ」ボタンで位置を微調整</p>
                <div class="button-group">
                    <button id="apply-order-button" disabled>クリック順で並べ替え</button>
                    <button id="clear-selection-button" disabled>選択をクリア</button>
                </div>
                 <div class="button-group">
                    <button id="swap-odd-even-button" disabled>偶数・奇数ページ入替</button>
                    <button id="reverse-all-button" disabled>全ページ逆順</button>
                </div>
                <div class="move-controls">
                    <h3>または、1ページを選択して移動:</h3>
                    <button id="move-prev-button" disabled>← 前へ</button>
                    <button id="move-next-button" disabled>次へ →</button>
                </div>
                <div class="slider-container">
                    <label for="size-slider-reorder">サムネイルサイズ:</label>
                    <input type="range" id="size-slider-reorder" min="100" max="400" value="150">
                </div>
            </div>
            <div id="gallery-reorder" class="gallery"></div>
        </div>

        <!-- ファイル分割タブ -->
        <div id="file-split-tab" class="tab-content">
            <div class="placeholder">
                <p>←「PDFの追加とクリア」タブでファイルをアップロードすると、ここにプレビューが表示されます。</p>
            </div>
            <div class="controls sticky">
                <h2>ファイル分割保存</h2>
                <p class="description">サムネイル間の縦線をクリックして分割位置を指定します。複数の分割位置を選択できます。「分割保存」ボタンをクリックすると、各パートのファイル名を入力するウィンドウが開きます。</p>
                <p class="description"><strong>例：</strong>10ページのPDFで、3ページと4ページの間、7ページと8ページの間に分割線を追加すると、1-3ページ、4-7ページ、8-10ページの3つのパートに分割されます。</p>
                <button id="execute-file-split-button" disabled>分割保存</button>
                <button id="clear-split-lines-button" disabled>分割線をクリア</button>
                <div class="slider-container">
                    <label for="size-slider-file-split">サムネイルサイズ:</label>
                    <input type="range" id="size-slider-file-split" min="100" max="400" value="150">
                </div>
            </div>
            <div id="gallery-file-split" class="gallery file-split-gallery"></div>
        </div>

        <!-- マスキングタブ -->
        <div id="mask-tab" class="tab-content">
            <div class="placeholder">
                <p>←「PDFの追加とクリア」タブでファイルをアップロードすると、ここにプレビューが表示されます。</p>
            </div>
            <div class="controls sticky">
                <h2>領域をマスキング（黒塗り）</h2>
                <p class="description">下のサムネイル一覧からページをクリックして選択すると、大きく表示されます。マスキングしたい領域をマウスでドラッグして選択し、適用ボタンをクリックすると黒塗りされます。</p>
                <div style="margin: 15px 0; display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                    <label for="mask-interval-select">
                        <select id="mask-interval-select" style="padding: 5px 10px; font-size: 14px;">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                        </select>
                    </label>
                    <span>ページ毎に</span>
                    <label for="mask-offset-select">
                        <select id="mask-offset-select" style="padding: 5px 10px; font-size: 14px;">
                            <option value="1">1</option>
                        </select>
                    </label>
                    <span>ページ目にマスキング</span>
                </div>
                <button id="apply-mask-button" disabled>マスキングを適用</button>
                <button id="clear-mask-button" disabled>選択をクリア</button>
                <div id="mask-info" style="margin-top: 10px; color: #666;"></div>
            </div>
            <div class="mask-layout">
                <div class="mask-canvas-wrapper">
                    <div id="mask-canvas-container" style="position: relative;">
                        <canvas id="mask-canvas" style="border: 2px solid #ccc; cursor: crosshair;"></canvas>
                    </div>
                </div>
                <div class="mask-gallery-wrapper">
                    <h3>ページ一覧</h3>
                    <div id="gallery-mask" class="gallery"></div>
                </div>
            </div>
        </div>

        <!-- 個別ファイル保存タブ -->
        <div id="split-files-tab" class="tab-content">
            <div class="placeholder">
                <p>←「PDFの追加とクリア」タブでファイルをアップロードすると、ここにプレビューが表示されます。</p>
            </div>
            <div class="controls">
                <h2>個別ページ保存</h2>
                <p>現在のPDFの各ページを個別のPDFファイルとして保存し、ZIPファイルとしてダウンロードします。</p>
                <p><strong>例：</strong>「資料.pdf」（5ページ）→「資料_1.pdf」「資料_2.pdf」「資料_3.pdf」「資料_4.pdf」「資料_5.pdf」をZIPファイルにまとめてダウンロード</p>

                <div style="margin: 15px 0; padding: 10px; background-color: #f5f5f5; border-radius: 5px;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="split-files-as-image-checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-weight: bold;">画像PDFとして保存（フォント問題を回避）</span>
                    </label>
                    <div id="split-files-dpi-container" style="margin-top: 10px; margin-left: 28px; display: none;">
                        <label for="split-files-dpi-select">画質（DPI）:</label>
                        <select id="split-files-dpi-select" style="padding: 5px 10px; font-size: 14px; margin-left: 10px;">
                            <option value="96">96 DPI（低画質・小サイズ）</option>
                            <option value="150" selected>150 DPI（標準画質）</option>
                            <option value="200">200 DPI（高画質）</option>
                            <option value="300">300 DPI（最高画質・大サイズ）</option>
                        </select>
                    </div>
                </div>

                <button id="split-to-files-button" disabled>各ページを個別ファイルに分割してダウンロード</button>
                <div class="slider-container">
                    <label for="size-slider-split-files">サムネイルサイズ:</label>
                    <input type="range" id="size-slider-split-files" min="100" max="400" value="150">
                </div>
            </div>
            <div id="gallery-split-files" class="gallery"></div>
        </div>

        <!-- 保存タブ -->
        <div id="save-tab" class="tab-content">
            <div class="placeholder">
                <p>←「PDFの追加とクリア」タブでファイルをアップロードすると、ここにプレビューが表示されます。</p>
            </div>
            <div class="controls">
                <h2>全体を保存</h2>
                <p>現在の編集状態を確認し、ボタンをクリックするとPDFファイルが自動的にダウンロードされます。</p>
                <p><strong>💡 ヒント：</strong>各タブ（分割、削除、編集、並べ替え）で行った編集内容はすべて反映されています。タブは任意の順序で使用できます。</p>
                <button id="save-pdf-button" disabled>名前をつけてダウンロード</button>

                <h3 style="margin-top: 30px;">画像PDFとして保存（フォント問題を回避）</h3>
                <p>PDFを画像ベースのPDFに変換して保存します。フォントが正しく表示されない問題を解決できます。</p>
                <div style="margin: 10px 0; display: flex; align-items: center; gap: 10px;">
                    <label for="image-pdf-dpi-select">画質（DPI）:</label>
                    <select id="image-pdf-dpi-select" style="padding: 5px 10px; font-size: 14px;">
                        <option value="96">96 DPI（低画質・小サイズ）</option>
                        <option value="150" selected>150 DPI（標準画質）</option>
                        <option value="200">200 DPI（高画質）</option>
                        <option value="300">300 DPI（最高画質・大サイズ）</option>
                    </select>
                </div>
                <button id="save-image-pdf-button" disabled>画像PDFとしてダウンロード</button>

                <div class="slider-container">
                    <label for="size-slider-save">サムネイルサイズ:</label>
                    <input type="range" id="size-slider-save" min="100" max="400" value="150">
                </div>
            </div>
            <div id="gallery-save" class="gallery"></div>
        </div>
    </div>

    <!-- ファイル名入力モーダル -->
    <div id="filename-modal" class="modal">
        <div class="modal-content">
            <h2>ファイル名を指定してダウンロード</h2>
            <p>保存するPDFファイルの名前を入力してください。</p>
            <div class="modal-input-container">
                <input type="text" id="filename-input" placeholder="ファイル名を入力">
                <span class="pdf-extension">.pdf</span>
            </div>
            <div class="modal-buttons">
                <button id="modal-download-button" class="modal-primary-button">ダウンロード</button>
                <button id="modal-cancel-button" class="modal-secondary-button">キャンセル</button>
            </div>
        </div>
    </div>

    <!-- ファイル分割保存モーダル -->
    <div id="file-split-modal" class="modal">
        <div class="modal-content modal-content-wide">
            <h2>分割ファイルの名前を指定</h2>
            <p>各パートのファイル名を入力してください。「保存不要」にチェックを入れたパートは保存されません。</p>
            <div id="split-parts-container" style="max-height: 400px; overflow-y: auto; margin: 20px 0;">
                <!-- JavaScriptで動的に生成 -->
            </div>
            <div class="modal-buttons">
                <button id="modal-split-save-button" class="modal-primary-button">分割保存を実行</button>
                <button id="modal-split-cancel-button" class="modal-secondary-button">キャンセル</button>
            </div>
        </div>
    </div>

    <script src="/static/script.js"></script>
</body>
</html>